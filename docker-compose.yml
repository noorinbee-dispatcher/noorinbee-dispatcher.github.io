
## Local JEKYLL service support
##
##
## ${VARIABLE:-default} will evaluate to default if VARIABLE is unset or empty in the environment.
## ${VARIABLE-default}  will evaluate to default only if VARIABLE is unset in the environment.
##
##
## -- DO NOT EDIT THIS FILE --
## instead, edit 'docker-compose.override.yml' with your custom changes (override or even new services).
##
## Edit '.env' for configuration.


version: '2.1'


################################################################################
# NETWORK
################################################################################
networks:
  doc_app_net:
    driver: bridge
    driver_opts:
      com.docker.network.enable_ipv6: "false"
    ipam:
      driver: default
      config:
        - subnet: 172.24.238.0/24
          gateway: 172.24.238.1


################################################################################
# SERVICES
################################################################################

#Elaborating:
#docker run --rm   --volume="$PWD:/srv/jekyll"   -it jekyll/jekyll:$JEKYLL_VERSION   jekyll build

services:
# Custom setup for Docker image here:
  jekyll:
    image: jekyll/jekyll:4.0.1
    hostname: jekyll  
    #ports:
      #- '4000:4000'
    networks:
      doc_app_net:
        ipv4_address: 172.24.238.80

    command: jekyll ${JEKYLL_EXEC} ${JEKYLL_CONF_EXEC}
    volumes:
      - ${JEKYLL_PATH}:/srv/jekyll:rw${MOUNT_OPTIONS}
      - jekyll-bundles:/usr/local/bundle:rw${MOUNT_OPTIONS}
      
    environment:
      ##
      ## Debug/Logging
      ##
      - DEBUG_ENTRYPOINT=${DEBUG_COMPOSE_ENTRYPOINT}
      - DEBUG_COMPOSE_ENTRYPOINT
      - DOCKER_LOGS
      - JEKYLL_ENV=docker
        
  # End of custom Docker image
  
 
  
# Custom setup for Docker image here:
  tlsproxy:
    image: nginx:1-alpine
    hostname: tlsproxy  
    ports:
      - '4001:4001'
      - '4002:4002'
    networks:
      doc_app_net:
        ipv4_address: 172.24.238.81

    volumes:
      - ${NGINX_CONFIG_PATH}:/etc/nginx/conf.d:rw${MOUNT_OPTIONS}
      
    environment:
      ##
      ## Debug/Logging
      ##
      - DEBUG_ENTRYPOINT=${DEBUG_COMPOSE_ENTRYPOINT}
      - DEBUG_COMPOSE_ENTRYPOINT
      - DOCKER_LOGS
        
  # End of custom Docker image
  
  
################################################################################
# VOLUMES
################################################################################
volumes:

  jekyll-bundles:
  jekyll-nginx:
